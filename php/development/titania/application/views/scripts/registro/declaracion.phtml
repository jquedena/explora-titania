<script type="text/javascript" src="<?php echo $this->util()->getPath(); ?>js/registro/declaracion.js"></script>


<input type="hidden" id="hdnIdDeclaracion" value="<?php echo $this->mhresum; ?>"/>
<input type="hidden" id="hdnIdPersona" value="<?php echo $this->mperson; ?>"/>
<input type="hidden" id="hdnAnioTermino" value="<?php echo $this->cperiod; ?>"/>
<table class="ui-table-panelLayout" border="0" width="100%">
    <tr>
        <td colspan="1" style="text-align: left ;font-weight: bold;">
        	La modificaci&oacute;n de esta declaraci&oacute;n <br/> entra en vigencia a partir del a&ntilde;o:
         	<input class="ui-text" style="width: 80px; text-align: left;" id="dtpFechaVigencia"/></td>
         <td  style="text-align: right;width: 130px; font-size:16px;color:navy;">Declaraci&oacute;n Jurada:</td>
        <td colspan="2" width="410px"><input style="font-size:16px;color:navy;" class="ui-text-disable" style="width: 100px" id="txtNroDeclaracion" /></td>
        
    </tr>
    <tr>
        <td colspan="4" style="padding: 2px;" width="100%"><hr/></td>
    </tr>
    <tr>
	    <td colspan="1">
	    	<div><table border="0" width="150">
	    		<tr>
	    			<td style="text-align: right">Fecha:</td>
	        		<td><input class="ui-text" style="width: 80px; text-align: center;" id="dtpFechaDeclaracion"/></td>
			        <td>&nbsp;</td>
			    </tr>
			    <tr>
			        <td style="text-align: right">Motivo:</td>
			        <td id="cellMotivo"><select style="width: 240px;" id="cboMotivo"><?php echo $this->util()->getComboContenedor('1000000004', null); ?></select></td>
			        <td>&nbsp;</td>
			    </tr>
			    <tr>
			        <td style="text-align: right;vertical-align: top;">Observaci&oacute;n:</td>
			        <td colspan="2"><textarea class="ui-text" class="jquery_ckeditor" cols="80" id="txtObservacion" name="txtObservacion" rows="10"></textarea></td>
			    </tr>
			    <tr>
			        <td colspan="3" style="text-align: right;">
			            <button id="btnAceptarDeclaracion">Aceptar</button>
			            <button id="btnCancelarDeclaracion">Cancelar</button>
			        </td>
			        </tr>
			        </table>
	         </div>  
	      </td>
	      <td id="dvBajalt" colspan="3" width="350">
	     		<div>
	     		<table border="0">
				<tr>
				<td height="180">Predio: </td>
				<td height="120"><input id="txtMpredio" type="hidden" /><input id="txtDirecpred" type="hidden" style="width:100%"/>
				    <input id="txtCodPre" class="ui-text-disable"/><br/>
				    <div id="dvtnomvia" ></div><br/>
				    <div id="dvtnompob"> </div> 
				 </td> 
				<td height="120"  align="center" > <button id="btnVerPredios" style="line-height: 20px; height: 20px;" >Buscar</button> </td>
				</tr>
				<tr>
				 		<td colspan="3">				    
								<div id="panelResultmPredio">							
								<table id="tblResultmPredio"></table>
								<div id="ptblResultmPredio"></div>
								</div>
				   		</td>	
				</tr>
				</table>
	    		</div>
	      
	      </td>
        
    </tr>
</table>
<script type="text/javascript">
    $(function(){

     $("#txtNroDeclaracion").html("0000000000");
        
        var config = {
            skin:'v2'
            , toolbar: [
                ['Bold','Italic','Underline','-','NumberedList','BulletedList','-','Outdent','Indent','-','Undo','Redo','-','HorizontalRule','-','Blockquote','CreateDiv','-','JustifyLeft','JustifyCenter','JustifyRight','JustifyBlock','-','TextColor','BGColor'],
                ['UIColor']
            ]
        }, _cmotivo = "";
        
        var hEd = CKEDITOR.instances['txtObservacion'];
        if (hEd) {
            CKEDITOR.remove(hEd);
        }
        CKEDITOR.replace('txtObservacion', config);
        
        $("#dtpFechaDeclaracion, #dtpFechaVigencia").datepicker({
            dateFormat: "dd/mm/yy",
            showOn: "button",
            buttonImage: pathImage + "calendar.gif",
            buttonImageOnly: true
        });
        
        themeComboBox("#cellMotivo select");
        
        $("#btnAceptarDeclaracion").button({
            icons: {primary:'ui-icon-check'}
        }).bind("click", function(){
            mhresum = {
	        	idsigma: $("#hdnIdDeclaracion").val(),
	        	ctipdat: "1000000002", /* Registro Tributario */
	        	vnrodoc: 0,  //$("#hdnId").val(),
	        	dfecdoc: $("#dtpFechaDeclaracion").val(),
	        	cmotivo: $("#cboMotivo").val() ,
	        	ctipdoc: "1000000021", /* Declaracion Jurada */
	        	vnrodjj: $("#txtNroDeclaracion").text(),
	        	vobserv: $("#txtObservacion").val(),
	        	nestado: "1",
	        	cperini: $("#dtpFechaVigencia").val(),
	        	cperfin: $("#hdnAnioTermino").val(),
	        	mperson: $("#hdnIdPersona").val(),
	        	mpredio: $("#txtMpredio").val() 
        	};
        	console.log(mhresum);

        	_post = $.post(path + "registro/guardardeclaracion", mhresum);
            _post.success(function(data){
            	
        		openDialogWarning("Los datos han sido guardados.", 380, 150);
        		  
        		closeDialog('jqDialog1');
        	});
            
        });
        $("#btnCancelarDeclaracion").button({
            icons: {primary:'ui-icon-arrowreturnthick-1-w'}
        }).bind("click", function(){
            closeDialog("jqDialog1");
        });

	  function verificar(){    		
    		//alert(""+$("#txtMotivo").val());
    		//1000000008 --Compra
    		//1000000009 --Venta
	  		
			if ( $("#txtMotivo").val()=='COMPRA' ||  $("#txtMotivo").val()=='VENTA' ){
				$("#dvBajalt").show();			  		
    		}else{
    			$("#dvBajalt").hide();		
    		}
	  }	

	  $("#cboMotivo").change(function(){
		  if ( $("#cboMotivo").val()=='1000000008' ||  $("#cboMotivo").val()=='1000000009' ){
				$("#dvBajalt").show();			  		
			}else{
				$("#dvBajalt").hide();		
		 	}
	   	  });	 

        $("#txtMotivo").bind("autocompleteselect", verificar);
        $("#txtMotivo").bind("autocompletechange", verificar);

    	$("#dvBajalt").hide();	


        $("#btnVerPredios").button({
            icons: {primary:'ui-icon-search'}
        }).bind("click", function(){

        	row2={
					mperson: $("#hdnIdPersona").val()                	
        		}; 
        	
        	openDialogData2("registro/busqpredio", row2 , "600", "500", "Predios", function() {
            	
    	    	if(row != undefined) {
    	    		$("#txt_idsigma").val(row.idsigma);
    		        $("#txtnombre").val(row.nombre);
    		  //	$("#txt_instcnitems").val(row.cnitems);
    		        $("#txtdni").val(row.dni);
    		  //	$("#txt_instctipdat").val(row.ctipdat);       
    		  //	$("#txt_instvnrodoc").val(row.vnrodoc);
    		   		
    		 //		$("#txt_instdafecta").val(row.dafecta);     
    	   }  else {
    		   $("#txt_idsigma").val('-1');  
    		   
    	   		}
    		});
            
        }); 

        
        
    });
</script>